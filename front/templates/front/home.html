{% extends "front/base.html" %} 
{% load static %}
{% block title %}ECO Store{% endblock %}

{% block content %}
<!-- Include Font Awesome for the shopping basket icon -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
  .hero-section {
    display: flex;
    flex-direction: column; /* stack vertically */
    align-items: center; /* center horizontally */
    justify-content: center; /* center vertically */
    min-height: 100vh; /* full viewport height */
    text-align: center;
    background-color: #fff;
    padding: 20px;
  }

  .hero-title {
    font-size: 3rem;
    font-weight: bold;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    color: #28a745;
  }

  .hero-title i {
    font-size: 2.5rem;
  }

  .hero-text {
    width: 100%;
    max-width: 600px;
  }

  .search-bar {
    margin-top: 20px;
  }
</style>

<div class="hero-section">
  <!-- Title + icon -->
  <div class="hero-title">
    <i class="fas fa-shopping-basket"></i>
    ECO
  </div>

  <div class="hero-text">
    <div class="search-bar">
      <form class="d-flex" id="searchForm">
        <input
          class="form-control me-2"
          id="searchInput"
          type="search"
          placeholder="Search for products or enter product link"
          aria-label="Search"
          name="query"
          required
        />
        <button class="btn btn-outline-success" id="searchButton" type="submit">
          Search
        </button>
      </form>
    </div>
    <h1 class="hero-header">
      Search what
      <span class="highlight">you want</span>
    </h1>
    <p class="hero-des">or enter the product link from Amazon store</p>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var searchForm = document.getElementById("searchForm");
    var searchInput = document.getElementById("searchInput");

    searchForm.addEventListener("submit", function (event) {
      event.preventDefault(); // Prevent traditional form submission
      var searchInputValue = searchInput.value.trim();

      // Extract ASIN from Amazon URL
      var asin = null;
      if (searchInputValue.startsWith("http")) {
        try {
          var url = new URL(searchInputValue);
          var match = url.pathname.match(
            /\/(dp|gp\/product|product)\/([A-Z0-9]{10})/i
          );
          if (match) {
            asin = match[2];
          }
        } catch (err) {
          console.error("Invalid URL");
        }
      }

      // Redirect based on input type
      if (asin) {
        // If itâ€™s a valid Amazon link
        window.location.href =
          "{% url 'search_page' %}?asin=" + encodeURIComponent(asin);
      } else {
        // If it's a normal query, go to products page with query parameter
        window.location.href =
          "{% url 'products_page' %}?q=" + encodeURIComponent(searchInputValue);
      }
    });
  });

  window.onscroll = function () {
    moveSearchForm();
  };

  function moveSearchForm() {
    var searchForm = document.getElementById("searchForm");
    var searchButton = document.getElementById("searchButton");
    if (window.scrollY > 50) {
      searchForm.classList.add("search-in-navbar");
      searchButton.innerHTML = '<i class="bi bi-search"></i>';
    } else {
      searchForm.classList.remove("search-in-navbar");
      searchButton.innerHTML = "Search";
    }
  }

  let slideIndex = 0;
  showSlides(slideIndex);

  function showSlides(n) {
    let slides = document.querySelectorAll(".slide");
    let dots = document.querySelectorAll(".dot");

    if (n >= slides.length) {
      slideIndex = 0;
    } else if (n < 0) {
      slideIndex = slides.length - 1;
    }

    slides.forEach((slide, index) => {
      slide.style.transform = `translateX(${-slideIndex * 100}%)`;
    });

    dots.forEach((dot, index) => {
      dot.classList.remove("active");
      if (index === slideIndex) {
        dot.classList.add("active");
      }
    });
  }

  function nextSlide() {
    showSlides(++slideIndex);
  }

  document.querySelector(".prev").addEventListener("click", () => {
    showSlides(--slideIndex);
  });

  document.querySelector(".next").addEventListener("click", () => {
    showSlides(++slideIndex);
  });

  document.querySelectorAll(".dot").forEach((dot, index) => {
    dot.addEventListener("click", () => {
      showSlides((slideIndex = index));
    });
  });

  // Automatically change slides every 3 seconds
  setInterval(nextSlide, 3000);
</script>
{% endblock %}
